{% extends "base.html" %}
{% load govuk_frontend_django %}
{% block title %}My account - {{ user.first_name }} {% endblock %}
{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            <div class="govuk-notification-banner" role="region" aria-labelledby="govuk-notification-banner-title"
                 data-module="govuk-notification-banner">
                <div class="govuk-notification-banner__header">
                    <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
                        Important
                    </h2>
                </div>
                <div class="govuk-notification-banner__content">

                    <p class="govuk-notification-banner__heading">
                        Before starting a new CAF self-assessment, you must have a completed and signed off scoping
                        document
                        for stage 1 and 2 of the GovAssure process.
                    </p>

                </div>
            </div>
            <h2 class="govuk-heading-l" title="user email {{ current_profile.user.email }}">
                My {{ current_profile.role }} account
            </h2>
            <div><p class="govuk-hint">On this page you can view any assessments you have already submitted, continue
                any draft assessments and start a new assessment.</p></div>
            <form action="{% url 'create-draft-assessment' %}" method="GET">
                {% csrf_token %}
                <button type="submit" class="govuk-button govuk-button--secondary" data-module="govuk-button">
                    Start a draft assessment
                </button>
            </form>
            {% if not draft_systems %}
                <h3 class="govuk-heading-m govuk-!-margin-bottom-2">
                    Draft assessments
                </h3>
                <p class="govuk-body govuk-!-margin-bottom-2 govuk-hint">You don't have any draft assessments.
                </p>
            {% else %}
                <table class="govuk-table">
                    <caption class="govuk-table__caption govuk-table__caption--m">Draft assessments</caption>
                    <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Organisation name</th>
                        <th scope="col" class="govuk-table__header">System</th>
                        <th scope="col" class="govuk-table__header">Profile</th>
                        <th scope="col" class="govuk-table__header">Created by</th>
                        <th scope="col" class="govuk-table__header">Created on</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody class="govuk-table__body">
                    {% for draft in draft_systems %}
                        <tr class="govuk-table__row">
                            <td class="govuk-table__cell">
                                {{ draft.system__organisation__name }}
                            </td>
                            <td class="govuk-table__cell">
                                {{ draft.system__name }}
                            </td>
                            <td class="govuk-table__cell">
                                {{ draft.caf_profile }}
                            </td>
                            <td class="govuk-table__cell">
                                {{ draft.created_by__username }}
                            </td>
                            <td class="govuk-table__cell">
                                {{ draft.created_on }}
                            </td>
                            <td class="govuk-table__cell">
                                <a href="{% url 'edit-draft-assessment' assessment_id=draft.id %}"
                                   title="Continue editing the assessment">Edit</a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>

            {% endif %}
            <h3 class="govuk-heading-m">
                Submitted assessments
            </h3>
            <p class="govuk-body govuk-!-margin-bottom-2 govuk-hint">You didn't submit an assessment.
            </p>
        </div>

        <div class="govuk-grid-column-one-third">
            <h2 class="govuk-body" id="subsection-title">
                Logged in as {% if profile_count > 1 %}(
                <a href="{% url 'view-organisations' %}" class="govuk-link govuk-link--no-visited-state">
                    change
                </a>){% endif %}
                <span class="govuk-heading-m">
                    {{ current_profile.organisation.name }}
                </span>
            </h2>

            <nav role="navigation" aria-labelledby="subsection-title">
                <ul class="govuk-list">
                    <li>
                        <a href="{% url 'my-organisation' id=current_profile.id %}"
                           class="govuk-link govuk-link--no-visited-state">
                            Update your organisation
                        </a>
                    </li>
                </ul>
            </nav>


        </div>
    </div>
{% endblock %}
